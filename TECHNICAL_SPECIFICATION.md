# –¢–ï–•–ù–ò–ß–ï–°–ö–ê–Ø –°–ü–ï–¶–ò–§–ò–ö–ê–¶–ò–Ø –ü–†–û–ï–ö–¢–ê NORYX PREMIUM VPN

## 1. –û–ë–ó–û–† –ü–†–û–ï–ö–¢–ê

**–ù–∞–∑–≤–∞–Ω–∏–µ:** Noryx Premium VPN
**–¢–∏–ø:** –ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è VPN-–ø–æ–¥–ø–∏—Å–∫–∞–º–∏
**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** –ú–æ–Ω–æ–ª–∏—Ç–Ω–æ–µ Node.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π –≤–Ω–µ—à–Ω–µ–≥–æ VPN-–ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ RemnaWave

### 1.1 –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

–í–µ–±-–ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –ø—Ä–æ–¥–∞–∂–∏ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è VPN-–ø–æ–¥–ø–∏—Å–∫–∞–º–∏ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —Å–æ–∑–¥–∞–Ω–∏–µ–º VPN-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π —á–µ—Ä–µ–∑ RemnaWave API, —Å–∏—Å—Ç–µ–º–æ–π —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π, —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º–æ–π –∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–Ω–µ–ª—å—é.

### 1.2 –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –ø–æ—Ä—Ç–∞–ª** - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è, –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç
2. **–°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–ø–∏—Å–æ–∫** - –ø–æ–∫—É–ø–∫–∞, –ø—Ä–æ–¥–ª–µ–Ω–∏–µ, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–∞–º–∏
3. **VPN-–ø—Ä–æ–≤–∏–∂–µ–Ω–∏–Ω–≥** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ VPN-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —á–µ—Ä–µ–∑ RemnaWave API
4. **Smart Connect** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –∏ –≤—ã–¥–∞—á–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
5. **–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞** - —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ –∫–æ–¥—ã –∏ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤
6. **–°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –∏—Å—Ç–µ—á–µ–Ω–∏–∏ –ø–æ–¥–ø–∏—Å–æ–∫
7. **–°–∏—Å—Ç–µ–º–∞ —Ä–∞—Å—Å—ã–ª–æ–∫** - —Å–µ–≥–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ email/telegram —Ä–∞—Å—Å—ã–ª–∫–∏
8. **–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏, –ø–æ–¥–ø–∏—Å–∫–∞–º–∏, —Ç–∞—Ä–∏—Ñ–∞–º–∏
9. **–ù–æ–≤–æ—Å—Ç–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞** - –ø—É–±–ª–∏–∫–∞—Ü–∏—è –Ω–æ–≤–æ—Å—Ç–µ–π –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

---

## 2. –¢–ï–•–ù–û–õ–û–ì–ò–ß–ï–°–ö–ò–ô –°–¢–ï–ö

### 2.1 Backend

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è | –í–µ—Ä—Å–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-----------|-----------|--------|------------|
| **Runtime** | Node.js | 18+ | –°–µ—Ä–≤–µ—Ä–Ω–∞—è —Å—Ä–µ–¥–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è |
| **Framework** | Express.js | ^4.18.2 | –í–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è REST API |
| **Language** | JavaScript (ES6+) | - | –û—Å–Ω–æ–≤–Ω–æ–π —è–∑—ã–∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ |
| **Database Driver** | pg (node-postgres) | ^8.11.3 | PostgreSQL –¥—Ä–∞–π–≤–µ—Ä –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î |
| **Database ORM** | @supabase/supabase-js | latest | Supabase –∫–ª–∏–µ–Ω—Ç –¥–ª—è –æ–±–ª–∞—á–Ω–æ–π –ë–î |

### 2.2 –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

| –°–∏—Å—Ç–µ–º–∞ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –î–µ—Ç–∞–ª–∏ |
|---------|-----------|--------|
| **PostgreSQL** | –õ–æ–∫–∞–ª—å–Ω–∞—è –ë–î | –í–µ—Ä—Å–∏—è 14+, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ç–∞–±–ª–∏—Ü: users, subscriptions, vpn_configs, connection_logs, available_countries |
| **Supabase PostgreSQL** | –û–±–ª–∞—á–Ω–∞—è –ë–î | –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å—Ö–µ–º–∞ —Å RLS, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è: profiles, tariffs, news, referrals, notifications, mailings, payments |

### 2.3 –í–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã

| –°–µ—Ä–≤–∏—Å | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –ü—Ä–æ—Ç–æ–∫–æ–ª |
|--------|-----------|----------|
| **RemnaWave Panel** | VPN-–ø—Ä–æ–≤–∞–π–¥–µ—Ä | REST API (–ø–æ—Ä—Ç 3000) |
| **RemnaWave Subscription Page** | –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–¥–ø–∏—Å–æ–∫ VPN | HTTP (–ø–æ—Ä—Ç 3010) |
| **Supabase** | Database + Auth + Storage | HTTPS REST + PostgreSQL |

### 2.4 –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```json
{
  "dependencies": {
    "axios": "^1.6.2",              // HTTP –∫–ª–∏–µ–Ω—Ç –¥–ª—è RemnaWave API
    "cors": "^2.8.5",                // CORS middleware
    "dotenv": "^16.3.1",             // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
    "express": "^4.18.2",            // Web framework
    "express-rate-limit": "^7.1.5",  // Rate limiting
    "helmet": "^7.1.0",              // Security headers
    "jsonwebtoken": "^9.0.3",        // JWT —Ç–æ–∫–µ–Ω—ã
    "pg": "^8.11.3",                 // PostgreSQL –∫–ª–∏–µ–Ω—Ç
    "qrcode": "^1.5.3"               // QR code –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
  },
  "devDependencies": {
    "nodemon": "^3.0.2"              // Hot reload –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
  }
}
```

### 2.5 Frontend

| –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-----------|-----------|
| **HTML5** | –†–∞–∑–º–µ—Ç–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü |
| **CSS3** | –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è, –≥—Ä–∞–¥–∏–µ–Ω—Ç—ã, –∞–Ω–∏–º–∞—Ü–∏–∏ |
| **JavaScript (Vanilla)** | –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è –ª–æ–≥–∏–∫–∞, AJAX –∑–∞–ø—Ä–æ—Å—ã |
| **Bootstrap 5.3** | UI framework –¥–ª—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ |
| **jQuery** | DOM –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–∏ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ |

---

## 3. –ê–†–•–ò–¢–ï–ö–¢–£–†–ê –°–ò–°–¢–ï–ú–´

### 3.1 –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                         INTERNET                            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                              ‚îÇ HTTPS
                              ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                     REVERSE PROXY (Caddy)                   ‚îÇ
‚îÇ                  SSL Termination + Load Balancing           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ                     ‚îÇ                     ‚îÇ
        ‚ñº                     ‚ñº                     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Noryx App    ‚îÇ   ‚îÇ RemnaWave Panel  ‚îÇ   ‚îÇ RemnaWave Sub  ‚îÇ
‚îÇ  (Port 3000)  ‚îÇ   ‚îÇ   (Port 3000)    ‚îÇ   ‚îÇ  (Port 3010)   ‚îÇ
‚îÇ  Node.js +    ‚îÇ   ‚îÇ   Docker +       ‚îÇ   ‚îÇ     Docker     ‚îÇ
‚îÇ  Express      ‚îÇ   ‚îÇ   PostgreSQL     ‚îÇ   ‚îÇ                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇ                     ‚îÇ
        ‚îÇ                     ‚îÇ
        ‚ñº                     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  PostgreSQL   ‚îÇ   ‚îÇ RemnaWave Nodes  ‚îÇ
‚îÇ  (Port 5432)  ‚îÇ   ‚îÇ  (VPS servers)   ‚îÇ
‚îÇ  Local DB     ‚îÇ   ‚îÇ  Xray-core VPN   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇ
        ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         Supabase Cloud                  ‚îÇ
‚îÇ  PostgreSQL + Auth + RLS + Storage      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 3.2 –ü–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö

#### 3.2.1 –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

```
User ‚Üí POST /api/auth/register ‚Üí Supabase Auth (email/password) ‚Üí
‚Üí Create profile in DB ‚Üí Generate referral_code ‚Üí Return JWT token
```

#### 3.2.2 –ü–æ–∫—É–ø–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏

```
User ‚Üí POST /api/subscriptions/purchase (tariff_id, period) ‚Üí
‚Üí Validate tariff ‚Üí Check trial status ‚Üí
‚Üí Create RemnaWave user (API call) ‚Üí
‚Üí Save subscription to Supabase DB ‚Üí
‚Üí Deduct balance / Create payment record ‚Üí
‚Üí Process referral bonus (if referred) ‚Üí
‚Üí Return subscription URL
```

#### 3.2.3 Smart Connect (–≥–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è)

```
User ‚Üí POST /api/vpn/connect (userId, countryCode) ‚Üí
‚Üí Detect platform from User-Agent ‚Üí
‚Üí Check active subscription ‚Üí
‚Üí Get/Create RemnaWave subscription ‚Üí
‚Üí Return format based on platform:
  ‚Ä¢ iOS/Android: deep-link (shadowrocket://add/...)
  ‚Ä¢ Desktop: secure download token (/api/vpn/download/:token)
  ‚Ä¢ Unknown: QR code (base64 data URL)
```

---

## 4. –ë–ê–ó–ê –î–ê–ù–ù–´–•

### 4.1 –õ–æ–∫–∞–ª—å–Ω–∞—è PostgreSQL –ë–î (schema.sql)

#### –¢–∞–±–ª–∏—Ü–∞: `users`
```sql
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    email VARCHAR(255) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### –¢–∞–±–ª–∏—Ü–∞: `subscriptions`
```sql
CREATE TABLE subscriptions (
    id SERIAL PRIMARY KEY,
    user_id INTEGER NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    plan_type VARCHAR(50) NOT NULL, -- 'monthly', 'yearly', 'trial'
    status VARCHAR(50) DEFAULT 'active', -- 'active', 'expired', 'cancelled'
    started_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    expires_at TIMESTAMP NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### –¢–∞–±–ª–∏—Ü–∞: `vpn_configs`
```sql
CREATE TABLE vpn_configs (
    id SERIAL PRIMARY KEY,
    user_id INTEGER NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    subscription_id INTEGER NOT NULL REFERENCES subscriptions(id) ON DELETE CASCADE,
    remnawave_subscription_id VARCHAR(255) UNIQUE NOT NULL,
    country_code VARCHAR(10) DEFAULT 'auto',
    server_location VARCHAR(100),
    config_type VARCHAR(50), -- 'shadowsocks', 'vmess', 'vless'
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(user_id, subscription_id)
);
```

#### –¢–∞–±–ª–∏—Ü–∞: `connection_logs`
```sql
CREATE TABLE connection_logs (
    id SERIAL PRIMARY KEY,
    user_id INTEGER NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    platform VARCHAR(50), -- 'ios', 'android', 'windows', 'macos', 'linux'
    connection_type VARCHAR(50), -- 'deep-link', 'file', 'qr-code'
    country_code VARCHAR(10),
    connected_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### –¢–∞–±–ª–∏—Ü–∞: `available_countries`
```sql
CREATE TABLE available_countries (
    id SERIAL PRIMARY KEY,
    country_code VARCHAR(10) UNIQUE NOT NULL,
    country_name VARCHAR(100) NOT NULL,
    flag_emoji VARCHAR(10),
    is_available BOOLEAN DEFAULT true,
    priority INTEGER DEFAULT 0,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
-- Default countries: auto, us, uk, de, nl, sg, jp, ca
```

### 4.2 Supabase PostgreSQL –ë–î

#### –¢–∞–±–ª–∏—Ü–∞: `profiles`
```sql
CREATE TABLE profiles (
  id uuid PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE,
  username text UNIQUE,
  full_name text DEFAULT '',
  telegram_id text DEFAULT '',
  balance decimal(10,2) DEFAULT 0,
  role text DEFAULT 'user' CHECK (role IN ('user', 'admin')),
  referral_code text UNIQUE, -- 8 —Å–∏–º–≤–æ–ª–æ–≤ A-Z0-9
  referred_by uuid REFERENCES profiles(id),
  trial_used boolean DEFAULT false,
  created_at timestamptz DEFAULT now(),
  updated_at timestamptz DEFAULT now()
);
```

#### –¢–∞–±–ª–∏—Ü–∞: `tariffs`
```sql
CREATE TABLE tariffs (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  name text NOT NULL,
  description text DEFAULT '',
  price_monthly decimal(10,2) DEFAULT 0,
  price_quarterly decimal(10,2) DEFAULT 0,
  price_yearly decimal(10,2) DEFAULT 0,
  traffic_limit_gb integer DEFAULT 0, -- 0 = –±–µ–∑–ª–∏–º–∏—Ç
  max_devices integer DEFAULT 1,
  is_trial boolean DEFAULT false,
  is_active boolean DEFAULT true,
  sort_order integer DEFAULT 0,
  features jsonb DEFAULT '[]'::jsonb,
  created_at timestamptz DEFAULT now(),
  updated_at timestamptz DEFAULT now()
);
```

#### –¢–∞–±–ª–∏—Ü–∞: `subscriptions`
```sql
CREATE TABLE subscriptions (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL REFERENCES profiles(id) ON DELETE CASCADE,
  tariff_id uuid NOT NULL REFERENCES tariffs(id),
  remnawave_username text DEFAULT '',
  remnawave_user_uuid text DEFAULT '',
  subscription_url text DEFAULT '',
  status text DEFAULT 'active' CHECK (status IN ('active', 'trial', 'expired', 'cancelled')),
  starts_at timestamptz DEFAULT now(),
  expires_at timestamptz NOT NULL,
  created_at timestamptz DEFAULT now(),
  updated_at timestamptz DEFAULT now()
);
```

#### –¢–∞–±–ª–∏—Ü–∞: `referrals`
```sql
CREATE TABLE referrals (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  referrer_id uuid NOT NULL REFERENCES profiles(id) ON DELETE CASCADE,
  referred_id uuid NOT NULL REFERENCES profiles(id) ON DELETE CASCADE,
  bonus_amount decimal(10,2) DEFAULT 0,
  status text DEFAULT 'pending' CHECK (status IN ('pending', 'completed', 'cancelled')),
  created_at timestamptz DEFAULT now()
);
```

#### –¢–∞–±–ª–∏—Ü–∞: `notifications`
```sql
CREATE TABLE notifications (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL REFERENCES profiles(id) ON DELETE CASCADE,
  type text NOT NULL CHECK (type IN (
    'trial_expiry_24h', 'trial_expiry_10h', 'trial_expiry_0h',
    'subscription_expiry_24h', 'subscription_expiry_10h', 'subscription_expiry_0h',
    'discount_offer', 'custom'
  )),
  title text NOT NULL,
  message text NOT NULL,
  data jsonb DEFAULT '{}'::jsonb,
  status text DEFAULT 'sent' CHECK (status IN ('pending', 'sent', 'failed')),
  sent_at timestamptz,
  scheduled_at timestamptz,
  is_read boolean DEFAULT false,
  created_at timestamptz DEFAULT now()
);
```

#### –¢–∞–±–ª–∏—Ü–∞: `notification_templates`
```sql
CREATE TABLE notification_templates (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  type text UNIQUE NOT NULL,
  subject text NOT NULL,
  message text NOT NULL,
  telegram_template text DEFAULT '',
  variables jsonb DEFAULT '[]'::jsonb, -- ['username', 'tariff_name', ...]
  is_active boolean DEFAULT true,
  created_at timestamptz DEFAULT now(),
  updated_at timestamptz DEFAULT now()
);
```

#### –¢–∞–±–ª–∏—Ü–∞: `mailing_templates`
```sql
CREATE TABLE mailing_templates (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  name text NOT NULL,
  description text DEFAULT '',
  segment text DEFAULT 'all' CHECK (segment IN (
    'all', 'with_subscription', 'without_subscription',
    'trial', 'no_trial', 'inactive', 'custom'
  )),
  subject text NOT NULL,
  html_content text NOT NULL,
  image_url text DEFAULT '',
  gif_url text DEFAULT '',
  variables jsonb DEFAULT '[]'::jsonb,
  preview_data jsonb DEFAULT '{}'::jsonb,
  is_active boolean DEFAULT true,
  created_by uuid REFERENCES profiles(id),
  created_at timestamptz DEFAULT now(),
  updated_at timestamptz DEFAULT now()
);
```

#### –¢–∞–±–ª–∏—Ü–∞: `mailings`
```sql
CREATE TABLE mailings (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  template_id uuid NOT NULL REFERENCES mailing_templates(id) ON DELETE CASCADE,
  segment text NOT NULL,
  filter_conditions jsonb DEFAULT '{}'::jsonb,
  status text DEFAULT 'draft' CHECK (status IN (
    'draft', 'scheduled', 'sending', 'sent', 'paused', 'failed'
  )),
  scheduled_at timestamptz,
  started_at timestamptz,
  completed_at timestamptz,
  sent_count integer DEFAULT 0,
  failed_count integer DEFAULT 0,
  created_by uuid REFERENCES profiles(id),
  created_at timestamptz DEFAULT now()
);
```

#### –¢–∞–±–ª–∏—Ü–∞: `news`
```sql
CREATE TABLE news (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  title text NOT NULL,
  content text NOT NULL,
  image_url text DEFAULT '',
  category text DEFAULT 'general',
  is_published boolean DEFAULT false,
  published_at timestamptz,
  views integer DEFAULT 0,
  created_by uuid REFERENCES profiles(id),
  created_at timestamptz DEFAULT now(),
  updated_at timestamptz DEFAULT now()
);
```

#### –¢–∞–±–ª–∏—Ü–∞: `payments`
```sql
CREATE TABLE payments (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL REFERENCES profiles(id) ON DELETE CASCADE,
  subscription_id uuid REFERENCES subscriptions(id),
  amount decimal(10,2) NOT NULL,
  payment_method text DEFAULT 'balance',
  status text DEFAULT 'pending' CHECK (status IN ('pending', 'completed', 'failed', 'refunded')),
  transaction_id text DEFAULT '',
  created_at timestamptz DEFAULT now()
);
```

#### –¢–∞–±–ª–∏—Ü–∞: `app_settings`
```sql
CREATE TABLE app_settings (
  key text PRIMARY KEY,
  value jsonb DEFAULT '{}'::jsonb,
  updated_at timestamptz DEFAULT now()
);

-- –ü—Ä–∏–º–µ—Ä—ã –Ω–∞—Å—Ç—Ä–æ–µ–∫:
INSERT INTO app_settings (key, value) VALUES
  ('referral', '{"enabled": true, "bonus_type": "fixed", "bonus_amount": 50}'),
  ('trial', '{"enabled": true, "duration_days": 3, "traffic_limit_gb": 5}');
```

### 4.3 Row Level Security (RLS) Policies

–í—Å–µ —Ç–∞–±–ª–∏—Ü—ã –≤ Supabase –∏–º–µ—é—Ç –≤–∫–ª—é—á–µ–Ω–Ω—ã–π RLS. –ü—Ä–∏–º–µ—Ä—ã –ø–æ–ª–∏—Ç–∏–∫:

```sql
-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –ø–æ–¥–ø–∏—Å–∫–∏
CREATE POLICY "Users can view own subscriptions"
  ON subscriptions FOR SELECT
  TO authenticated
  USING (auth.uid() = user_id);

-- –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω—ã –º–æ–≥—É—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å —Ç–∞—Ä–∏—Ñ–∞–º–∏
CREATE POLICY "Admins can manage tariffs"
  ON tariffs FOR ALL
  TO authenticated
  USING (is_admin())
  WITH CHECK (is_admin());

-- –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–¥–º–∏–Ω–∞
CREATE OR REPLACE FUNCTION is_admin()
RETURNS boolean AS $$
  SELECT EXISTS (
    SELECT 1 FROM profiles
    WHERE id = auth.uid() AND role = 'admin'
  );
$$ LANGUAGE sql SECURITY DEFINER;
```

---

## 5. BACKEND API

### 5.1 –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
src/
‚îú‚îÄ‚îÄ server.js                 # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞, Express app
‚îú‚îÄ‚îÄ config.js                 # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ logger.js                 # Winston logger
‚îú‚îÄ‚îÄ security.js               # –í–∞–ª–∏–¥–∞—Ü–∏—è, —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è, XSS –∑–∞—â–∏—Ç–∞
‚îú‚îÄ‚îÄ scheduler.js              # Cron –∑–∞–¥–∞—á–∏ (—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, —Ä–∞—Å—Å—ã–ª–∫–∏)
‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îú‚îÄ‚îÄ db.js                 # PostgreSQL pool –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ init.js               # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î
‚îÇ   ‚îî‚îÄ‚îÄ schema.sql            # SQL —Å—Ö–µ–º–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î
‚îú‚îÄ‚îÄ middleware/
‚îÇ   ‚îú‚îÄ‚îÄ auth.js               # JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è middleware
‚îÇ   ‚îî‚îÄ‚îÄ adminAuth.js          # –ü—Ä–æ—Å—Ç–∞—è Bearer token –∞–¥–º–∏–Ω –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îú‚îÄ‚îÄ vpn.js                # VPN endpoints (connect, countries, download)
‚îÇ   ‚îú‚îÄ‚îÄ admin.js              # –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å endpoints (users, stats, logs)
‚îÇ   ‚îú‚îÄ‚îÄ auth.js               # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –ª–æ–≥–∏–Ω, –ø—Ä–æ—Ñ–∏–ª—å (Supabase)
‚îÇ   ‚îú‚îÄ‚îÄ subscriptions.js      # –ü–æ–∫—É–ø–∫–∞, –ø—Ä–æ–¥–ª–µ–Ω–∏–µ, –æ—Ç–º–µ–Ω–∞ –ø–æ–¥–ø–∏—Å–æ–∫
‚îÇ   ‚îú‚îÄ‚îÄ tariffs.js            # –°–ø–∏—Å–æ–∫ —Ç–∞—Ä–∏—Ñ–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ referrals.js          # –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞
‚îÇ   ‚îú‚îÄ‚îÄ news.js               # –ù–æ–≤–æ—Å—Ç–∏
‚îÇ   ‚îú‚îÄ‚îÄ notifications.js      # –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îÇ   ‚îú‚îÄ‚îÄ mailings.js           # –†–∞—Å—Å—ã–ª–∫–∏ (–∞–¥–º–∏–Ω)
‚îÇ   ‚îî‚îÄ‚îÄ servers.js            # –°–ø–∏—Å–æ–∫ —Å–µ—Ä–≤–µ—Ä–æ–≤ RemnaWave
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ remnawave.js          # RemnaWave API –∫–ª–∏–µ–Ω—Ç
‚îÇ   ‚îú‚îÄ‚îÄ platformDetector.js   # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã (iOS/Android/Desktop)
‚îÇ   ‚îú‚îÄ‚îÄ tokenService.js       # HMAC —Ç–æ–∫–µ–Ω—ã –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ qrService.js          # QR code –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
‚îî‚îÄ‚îÄ supabase.js               # Supabase –∫–ª–∏–µ–Ω—Ç + auth helpers
```

### 5.2 –û—Å–Ω–æ–≤–Ω—ã–µ endpoints

#### 5.2.1 VPN Routes (`/api/vpn/`)

**POST /api/vpn/connect**
Smart Connect - –≥–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã

Request:
```json
{
  "userId": 1,
  "countryCode": "us"
}
```

Response (iOS/Android):
```json
{
  "platform": "ios",
  "deliveryFormat": "deep-link",
  "serverLocation": "United States (New York)",
  "countryCode": "us",
  "deepLink": "shadowrocket://add/vmess://eyJhZGQiOi...",
  "configUrl": "https://api.remnawave.com/sub/abc123xyz"
}
```

Response (Desktop):
```json
{
  "platform": "windows",
  "deliveryFormat": "file",
  "serverLocation": "United States (New York)",
  "countryCode": "us",
  "downloadUrl": "/api/vpn/download/eyJhbGciOiJIUzI1NiIs...",
  "expiresIn": 300
}
```

Response (Unknown):
```json
{
  "platform": "unknown",
  "deliveryFormat": "qr-code",
  "serverLocation": "United States (New York)",
  "countryCode": "us",
  "qrCode": "data:image/png;base64,iVBORw0KGgo...",
  "configUrl": "https://api.remnawave.com/sub/abc123xyz"
}
```

**GET /api/vpn/countries**
–°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å—Ç—Ä–∞–Ω

Response:
```json
{
  "countries": [
    {
      "country_code": "auto",
      "country_name": "Auto (Best)",
      "flag_emoji": "üåç",
      "is_available": true
    },
    {
      "country_code": "us",
      "country_name": "United States",
      "flag_emoji": "üá∫üá∏",
      "is_available": true
    }
  ]
}
```

**POST /api/vpn/change-country**
–°–º–µ–Ω–∞ —Å—Ç—Ä–∞–Ω—ã VPN

Request:
```json
{
  "userId": 1,
  "countryCode": "uk"
}
```

**GET /api/vpn/download/:token**
–°–∫–∞—á–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥ —Ñ–∞–π–ª –ø–æ —Ç–æ–∫–µ–Ω—É (–¥–ª—è Desktop)

- –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç HMAC token (5 –º–∏–Ω—É—Ç –∂–∏–∑–Ω–∏)
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å headers:
  - `Content-Type: application/octet-stream`
  - `Content-Disposition: attachment; filename="noryx-vpn-config.conf"`

#### 5.2.2 Auth Routes (`/api/auth/`)

**POST /api/auth/register**
–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ Supabase Auth

Request:
```json
{
  "email": "user@example.com",
  "password": "password123",
  "username": "john_doe",
  "referralCode": "ABC12345"
}
```

Response:
```json
{
  "user": {
    "id": "123e4567-e89b-12d3-a456-426614174000",
    "email": "user@example.com"
  },
  "session": {
    "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refresh_token": "...",
    "expires_in": 3600
  }
}
```

**POST /api/auth/login**
–í—Ö–æ–¥ —á–µ—Ä–µ–∑ Supabase Auth

**POST /api/auth/logout**
–í—ã—Ö–æ–¥

**GET /api/auth/profile**
–ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Ç—Ä–µ–±—É–µ—Ç JWT)

**PUT /api/auth/profile**
–û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å

#### 5.2.3 Subscriptions Routes (`/api/subscriptions/`)

**GET /api/subscriptions/**
–°–ø–∏—Å–æ–∫ –ø–æ–¥–ø–∏—Å–æ–∫ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Å –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ RemnaWave API)

Response:
```json
[
  {
    "id": "uuid",
    "user_id": "uuid",
    "tariff_id": "uuid",
    "tariff": {
      "name": "Premium",
      "traffic_limit_gb": 100
    },
    "remnawave_username": "web_1234567890abc_xyz",
    "subscription_url": "https://panel.example.com/api/sub/shortUuid",
    "status": "active",
    "starts_at": "2026-02-01T00:00:00Z",
    "expires_at": "2026-03-01T00:00:00Z",
    "traffic_used_gb": 15.3,
    "traffic_limit_gb": 100,
    "online_at": "2026-02-15T10:30:00Z",
    "remna_status": "ACTIVE"
  }
]
```

**POST /api/subscriptions/purchase**
–ü–æ–∫—É–ø–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏

Request:
```json
{
  "tariff_id": "uuid",
  "period": "monthly"
}
```

–õ–æ–≥–∏–∫–∞:
1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∞—Ä–∏—Ñ–∞ (–∞–∫—Ç–∏–≤–µ–Ω –ª–∏, —Ç—Ä–∏–∞–ª –ª–∏)
2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç—Ä–∏–∞–ª–∞
3. –†–∞—Å—á–µ—Ç —Å—Ä–æ–∫–∞ –∏ —Ü–µ–Ω—ã
4. –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ RemnaWave API
5. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏ –≤ –ë–î
6. –°–ø–∏—Å–∞–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ / —Å–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞
7. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–≥–æ –±–æ–Ω—É—Å–∞

**POST /api/subscriptions/:id/renew**
–ü—Ä–æ–¥–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏

**DELETE /api/subscriptions/:id**
–û—Ç–º–µ–Ω–∞ –ø–æ–¥–ø–∏—Å–∫–∏ (disable –≤ RemnaWave + —Å—Ç–∞—Ç—É—Å cancelled)

#### 5.2.4 Admin Routes (`/api/admin/`)

–¢—Ä–µ–±—É—é—Ç `Authorization: Bearer {ADMIN_PASSWORD}` header.

**GET /api/admin/users**
–°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –ø–æ–¥–ø–∏—Å–æ–∫

**GET /api/admin/subscriptions**
–í—Å–µ –ø–æ–¥–ø–∏—Å–∫–∏

**PATCH /api/admin/subscriptions/:id/renew**
–ü—Ä–æ–¥–ª–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ N –¥–Ω–µ–π

**PATCH /api/admin/subscriptions/:id/cancel**
–û—Ç–º–µ–Ω–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É

**POST /api/admin/subscriptions/grant-trial**
–í—ã–¥–∞—Ç—å —Ç—Ä–∏–∞–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

**GET /api/admin/countries**
–í—Å–µ —Å—Ç—Ä–∞–Ω—ã (–≤–∫–ª—é—á–∞—è –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–µ)

**PATCH /api/admin/countries/:code/toggle**
–í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å —Å—Ç—Ä–∞–Ω—É

**GET /api/admin/stats**
–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –ø–æ–¥–ø–∏—Å–∫–∏, –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è, —Ç–æ–ø —Å—Ç—Ä–∞–Ω, –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã)

**GET /api/admin/connection-logs**
–õ–æ–≥–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π

#### 5.2.5 –î—Ä—É–≥–∏–µ Routes

**GET /api/tariffs/**
–°–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ç–∞—Ä–∏—Ñ–æ–≤

**GET /api/referrals/**
–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (—Ç—Ä–µ–±—É–µ—Ç auth)

**GET /api/news/**
–ù–æ–≤–æ—Å—Ç–∏ (–æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã–µ)

**GET /api/notifications/**
–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Ç—Ä–µ–±—É–µ—Ç auth)

**GET /api/servers/**
–°–ø–∏—Å–æ–∫ —Å–µ—Ä–≤–µ—Ä–æ–≤ RemnaWave (nodes)

**POST /api/mailings/** (admin)
–°–æ–∑–¥–∞—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É

**GET /api/settings/:key**
–ü–æ–ª—É—á–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É –∏–∑ app_settings

### 5.3 Middleware

#### auth.js (JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è)
```javascript
const jwt = require('jsonwebtoken');

function authenticateToken(req, res, next) {
  const authHeader = req.headers['authorization'];
  const token = authHeader && authHeader.split(' ')[1];

  if (!token) {
    return res.status(401).json({ error: 'No authentication token provided' });
  }

  jwt.verify(token, JWT_SECRET, (err, user) => {
    if (err) {
      return res.status(403).json({ error: 'Invalid or expired token' });
    }
    req.user = user;
    next();
  });
}
```

#### adminAuth.js (–ü—Ä–æ—Å—Ç–∞—è admin –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è)
```javascript
const adminAuth = (req, res, next) => {
  const adminPassword = process.env.ADMIN_PASSWORD || 'admin123';
  const authHeader = req.headers.authorization;

  if (!authHeader || !authHeader.startsWith('Bearer ')) {
    return res.status(401).json({ error: 'Admin authentication required' });
  }

  const token = authHeader.substring(7);

  if (token !== adminPassword) {
    return res.status(403).json({ error: 'Invalid admin credentials' });
  }

  next();
};
```

#### requireAuth (Supabase Auth)
```javascript
export async function requireAuth(req, res, next) {
  const user = await getAuthUser(req);
  if (!user) {
    return res.status(401).json({ error: '–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è' });
  }
  req.user = user;
  next();
}
```

---

## 6. –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø REMNAWAVE API

### 6.1 RemnaWave Service (src/services/remnawave.js)

RemnaWave - —ç—Ç–æ VPN-–ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞ –±–∞–∑–µ Xray-core. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç REST API.

#### –ú–µ—Ç–æ–¥—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

1. **Token mode** - Bearer token –≤ Authorization header
2. **Basic mode** - –õ–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å —Å —Å–µ—Å—Å–∏–æ–Ω–Ω—ã–º–∏ cookies

#### API Endpoints –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –≤ –ø—Ä–æ–µ–∫—Ç–µ

| –ú–µ—Ç–æ–¥ | Endpoint | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-------|----------|------------|
| POST | `/api/auth/login` | –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (basic mode) |
| GET | `/api/nodes` | –°–ø–∏—Å–æ–∫ VPN-–Ω–æ–¥ |
| GET | `/api/users` | –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π |
| GET | `/api/users/:username` | –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ |
| POST | `/api/users` | –°–æ–∑–¥–∞—Ç—å VPN-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| PUT | `/api/users/:uuid` | –û–±–Ω–æ–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| DELETE | `/api/users/:uuid` | –£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| POST | `/api/users/disable/:uuid` | –î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å |
| POST | `/api/users/enable/:uuid` | –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å |
| GET | `/api/inbounds` | –°–ø–∏—Å–æ–∫ inbound-–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π |
| GET | `/api/system` | –°–∏—Å—Ç–µ–º–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ |

#### –°–æ–∑–¥–∞–Ω–∏–µ VPN-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```javascript
async createUser({ username, trafficLimitBytes = 0, expireAt, deviceLimit = 1 }) {
  return apiRequest('POST', '/api/users', {
    username,
    trafficLimitStrategy: trafficLimitBytes > 0 ? 'CUSTOM' : 'NO_LIMIT',
    trafficLimitBytes,
    expireAt,
    activateAllInbounds: true,
    hwidDeviceLimit: deviceLimit,
    status: 'ACTIVE',
  });
}
```

**Response –ø—Ä–∏–º–µ—Ä:**
```json
{
  "response": {
    "uuid": "123e4567-e89b-12d3-a456-426614174000",
    "username": "web_abc123_xyz",
    "subscriptionUrl": "https://panel.example.com/api/sub/shortUuid",
    "status": "ACTIVE",
    "trafficLimitBytes": 107374182400,
    "usedTrafficBytes": 0,
    "expireAt": "2026-03-01T00:00:00Z",
    "hwidDeviceLimit": 3,
    "onlineAt": null
  }
}
```

#### –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Ç—Ä–∞—Ñ–∏–∫, —Å—Ç–∞—Ç—É—Å)

```javascript
async getUser(username) {
  return apiRequest('GET', `/api/users/${username}`);
}
```

**Response:**
```json
{
  "response": {
    "uuid": "...",
    "username": "web_abc123_xyz",
    "usedTrafficBytes": 16106127360,
    "trafficLimitBytes": 107374182400,
    "status": "ACTIVE",
    "onlineAt": "2026-02-15T10:30:00Z",
    "subscriptionUrl": "..."
  }
}
```

### 6.2 –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ RemnaWave

```
Config Profile ‚Üí Node ‚Üí Host ‚Üí Internal Squad ‚Üí User ‚Üí Subscription
```

1. **Config Profile** - —à–∞–±–ª–æ–Ω –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ (VLESS, VMess, etc)
2. **Node** - VPS —Å–µ—Ä–≤–µ—Ä —Å Xray-core
3. **Host** - —Ö–æ—Å—Ç –≤–Ω—É—Ç—Ä–∏ –Ω–æ–¥—ã
4. **Internal Squad** - –≥—Ä—É–ø–ø–∞ inbound-–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
5. **User** - VPN-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (–Ω–∞—à –∫–ª–∏–µ–Ω—Ç)
6. **Subscription** - URL –ø–æ–¥–ø–∏—Å–∫–∏ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –≤ VPN-–∫–ª–∏–µ–Ω—Ç

---

## 7. –ü–õ–ê–¢–§–û–†–ú–´ –ò SMART CONNECT

### 7.1 –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã (src/services/platformDetector.js)

```javascript
const platformPatterns = {
  ios: /iPhone|iPad|iPod/i,
  android: /Android/i,
  windows: /Windows/i,
  macos: /Macintosh|Mac OS X/i,
  linux: /Linux/i,
};

function detectPlatform(userAgent) {
  if (!userAgent) return 'unknown';

  if (platformPatterns.ios.test(userAgent)) return 'ios';
  if (platformPatterns.android.test(userAgent)) return 'android';
  if (platformPatterns.windows.test(userAgent)) return 'windows';
  if (platformPatterns.macos.test(userAgent)) return 'macos';
  if (platformPatterns.linux.test(userAgent)) return 'linux';

  return 'unknown';
}
```

### 7.2 –§–æ—Ä–º–∞—Ç—ã –¥–æ—Å—Ç–∞–≤–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

| –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ | –§–æ—Ä–º–∞—Ç | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è |
|-----------|--------|------------|
| iOS | deep-link | `shadowrocket://add/{configUrl}` |
| Android | deep-link | `v2rayng://install-config?url={configUrl}` |
| Windows/macOS/Linux | file | Secure download token ‚Üí `/api/vpn/download/:token` |
| Unknown | qr-code | QR code data URL (PNG base64) |

### 7.3 Deep-link —Å—Ö–µ–º—ã

```javascript
const schemes = {
  ios: {
    shadowsocks: 'shadowrocket://add/',
    vmess: 'shadowrocket://add/',
    vless: 'shadowrocket://add/',
  },
  android: {
    shadowsocks: 'v2rayng://install-config?url=',
    vmess: 'v2rayng://install-config?url=',
    vless: 'v2rayng://install-config?url=',
  },
};
```

### 7.4 HMAC Token Service (tokenService.js)

–î–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π –Ω–∞ Desktop –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è HMAC —Ç–æ–∫–µ–Ω—ã —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º —Å—Ä–æ–∫–æ–º –∂–∏–∑–Ω–∏ (5 –º–∏–Ω—É—Ç).

```javascript
function generateDownloadToken(userId, subscriptionId) {
  const expiresAt = Date.now() + TOKEN_EXPIRY * 1000; // 300 —Å–µ–∫
  const payload = `${userId}:${subscriptionId}:${expiresAt}`;

  const hmac = crypto
    .createHmac('sha256', HMAC_SECRET)
    .update(payload)
    .digest('hex');

  const token = Buffer.from(`${payload}:${hmac}`).toString('base64url');
  return token;
}

function validateDownloadToken(token) {
  try {
    const decoded = Buffer.from(token, 'base64url').toString('utf8');
    const [userId, subscriptionId, expiresAt, providedHmac] = decoded.split(':');

    // Check expiration
    if (Date.now() > parseInt(expiresAt)) return null;

    // Verify HMAC
    const payload = `${userId}:${subscriptionId}:${expiresAt}`;
    const expectedHmac = crypto
      .createHmac('sha256', HMAC_SECRET)
      .update(payload)
      .digest('hex');

    if (expectedHmac !== providedHmac) return null;

    return { userId: parseInt(userId), subscriptionId, expiresAt: parseInt(expiresAt) };
  } catch {
    return null;
  }
}
```

### 7.5 QR Code Service (qrService.js)

```javascript
const QRCode = require('qrcode');

async function generateQRCode(text) {
  const qrDataUrl = await QRCode.toDataURL(text, {
    errorCorrectionLevel: 'M',
    type: 'image/png',
    width: 300,
    margin: 2,
  });
  return qrDataUrl; // data:image/png;base64,...
}
```

---

## 8. –°–ò–°–¢–ï–ú–ê –£–í–ï–î–û–ú–õ–ï–ù–ò–ô

### 8.1 –¢–∏–ø—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

1. **trial_expiry_24h** - –¢—Ä–∏–∞–ª –∏—Å—Ç–µ–∫–∞–µ—Ç —á–µ—Ä–µ–∑ 24 —á–∞—Å–∞
2. **trial_expiry_10h** - –¢—Ä–∏–∞–ª –∏—Å—Ç–µ–∫–∞–µ—Ç —á–µ—Ä–µ–∑ 10 —á–∞—Å–æ–≤
3. **trial_expiry_0h** - –¢—Ä–∏–∞–ª –∏—Å—Ç–µ–∫
4. **subscription_expiry_24h** - –ü–æ–¥–ø–∏—Å–∫–∞ –∏—Å—Ç–µ–∫–∞–µ—Ç —á–µ—Ä–µ–∑ 24 —á–∞—Å–∞
5. **subscription_expiry_10h** - –ü–æ–¥–ø–∏—Å–∫–∞ –∏—Å—Ç–µ–∫–∞–µ—Ç —á–µ—Ä–µ–∑ 10 —á–∞—Å–æ–≤
6. **subscription_expiry_0h** - –ü–æ–¥–ø–∏—Å–∫–∞ –∏—Å—Ç–µ–∫–ª–∞
7. **discount_offer** - –°–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ
8. **custom** - –ö–∞—Å—Ç–æ–º–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ

### 8.2 –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (src/scheduler.js)

Cron –∑–∞–¥–∞—á–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–π —á–∞—Å:

```javascript
setInterval(checkSubscriptionsExpiry, 60 * 60 * 1000);
```

–ê–ª–≥–æ—Ä–∏—Ç–º:
1. –í—ã–±—Ä–∞—Ç—å –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏ (status: active/trial)
2. –î–ª—è –∫–∞–∂–¥–æ–π –ø–æ–¥–ø–∏—Å–∫–∏ –≤—ã—á–∏—Å–ª–∏—Ç—å —á–∞—Å—ã –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –Ω—É–∂–Ω–æ –ª–∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (–æ–∫–Ω–æ ¬±30 –º–∏–Ω—É—Ç):
   - 24 —á–∞—Å–∞ (23.5-24.5)
   - 10 —á–∞—Å–æ–≤ (9.5-10.5)
   - 0 —á–∞—Å–æ–≤ (–∏—Å—Ç–µ–∫–ª–∞)
4. –ó–∞–≥—Ä—É–∑–∏—Ç—å —à–∞–±–ª–æ–Ω —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
5. –ò–Ω—Ç–µ—Ä–ø–æ–ª–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ: `{{username}}`, `{{tariff_name}}`, `{{expiry_date}}`
6. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ —Ç–∞–±–ª–∏—Ü—É `notifications`
7. –ó–∞–ø–∏—Å–∞—Ç—å –≤ `notification_history` (–¥–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏)
8. –ü—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ (0h) - —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏: `expired`

### 8.3 –®–∞–±–ª–æ–Ω—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (notification_templates)

–ü—Ä–∏–º–µ—Ä —à–∞–±–ª–æ–Ω–∞:
```json
{
  "type": "subscription_expiry_24h",
  "subject": "–í–∞—à–∞ –ø–æ–¥–ø–∏—Å–∫–∞ —Å–∫–æ—Ä–æ –∏—Å—Ç–µ—á–µ—Ç",
  "message": "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, {{username}}! –í–∞—à —Ç–∞—Ä–∏—Ñ \"{{tariff_name}}\" –∏—Å—Ç–µ–∫–∞–µ—Ç {{time_text}}. –ü—Ä–æ–¥–ª–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É, —á—Ç–æ–±—ã –Ω–µ –ø–æ—Ç–µ—Ä—è—Ç—å –¥–æ—Å—Ç—É–ø.",
  "telegram_template": "üîî –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ: —Ç–∞—Ä–∏—Ñ {{tariff_name}} –∏—Å—Ç–µ–∫–∞–µ—Ç —á–µ—Ä–µ–∑ 24 —á–∞—Å–∞",
  "variables": ["username", "tariff_name", "expiry_date", "expiry_time", "time_text"],
  "is_active": true
}
```

---

## 9. –°–ò–°–¢–ï–ú–ê –†–ê–°–°–´–õ–û–ö

### 9.1 –°–µ–≥–º–µ–Ω—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

- **all** - –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- **with_subscription** - –° –∞–∫—Ç–∏–≤–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–æ–π
- **without_subscription** - –ë–µ–∑ –∞–∫—Ç–∏–≤–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–∏
- **trial** - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ —Ç—Ä–∏–∞–ª
- **no_trial** - –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ —Ç—Ä–∏–∞–ª
- **inactive** - –ù–µ –∑–∞—Ö–æ–¥–∏–ª–∏ 30+ –¥–Ω–µ–π
- **custom** - –ö–∞—Å—Ç–æ–º–Ω—ã–π SQL —Ñ–∏–ª—å—Ç—Ä

### 9.2 –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ —Ä–∞—Å—Å—ã–ª–æ–∫

Cron –∑–∞–¥–∞—á–∞ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç:

```javascript
setInterval(processPendingMailings, 5 * 60 * 1000);
```

–ê–ª–≥–æ—Ä–∏—Ç–º:
1. –í—ã–±—Ä–∞—Ç—å —Ä–∞—Å—Å—ã–ª–∫–∏ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `scheduled` –∏ `scheduled_at <= NOW()`
2. –î–ª—è –∫–∞–∂–¥–æ–π —Ä–∞—Å—Å—ã–ª–∫–∏:
   - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å `sending`
   - –ó–∞–≥—Ä—É–∑–∏—Ç—å —à–∞–±–ª–æ–Ω —Ä–∞—Å—Å—ã–ª–∫–∏
   - –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π –ø–æ —Å–µ–≥–º–µ–Ω—Ç—É
   - –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
     - –û—Ç—Ä–µ–Ω–¥–µ—Ä–∏—Ç—å HTML (–∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è: `{{username}}`, `{{email}}`)
     - –û—Ç–ø—Ä–∞–≤–∏—Ç—å email/telegram (–≤ —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç–æ–ª—å–∫–æ logging)
     - –ó–∞–ø–∏—Å–∞—Ç—å –≤ `mailing_history`
   - –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Ä–∞—Å—Å—ã–ª–∫–∏: `sent`
   - –ó–∞–ø–∏—Å–∞—Ç—å `sent_count` –∏ `failed_count`

### 9.3 –®–∞–±–ª–æ–Ω—ã —Ä–∞—Å—Å—ã–ª–æ–∫ (mailing_templates)

–ü—Ä–∏–º–µ—Ä:
```json
{
  "name": "–°–∫–∏–¥–∫–∞ 50% –Ω–∞ Premium",
  "segment": "without_subscription",
  "subject": "–°–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ: —Å–∫–∏–¥–∫–∞ 50%",
  "html_content": "<h1>–ü—Ä–∏–≤–µ—Ç, {{username}}!</h1><p>–¢–æ–ª—å–∫–æ —Å–µ–≥–æ–¥–Ω—è —Å–∫–∏–¥–∫–∞ 50% –Ω–∞ —Ç–∞—Ä–∏—Ñ Premium.</p><img src='{{image_url}}' />",
  "image_url": "https://example.com/promo.png",
  "gif_url": "",
  "variables": ["username", "email"],
  "is_active": true
}
```

---

## 10. –†–ï–§–ï–†–ê–õ–¨–ù–ê–Ø –°–ò–°–¢–ï–ú–ê

### 10.1 –ú–µ—Ö–∞–Ω–∏–∫–∞

1. –ü—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∫–∞–∂–¥–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —É–Ω–∏–∫–∞–ª—å–Ω—ã–π `referral_code` (8 —Å–∏–º–≤–æ–ª–æ–≤ A-Z0-9)
2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∏–≥–ª–∞—à–∞–µ—Ç –¥—Ä—É–≥–∞ –ø–æ —Å—Å—ã–ª–∫–µ: `https://noryx.com/register?ref=ABC12345`
3. –î—Ä—É–≥ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è —Å `referralCode` –≤ –∑–∞–ø—Ä–æ—Å–µ
4. –í –ø—Ä–æ—Ñ–∏–ª–µ –¥—Ä—É–≥–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è `referred_by: referrer_id`
5. –ö–æ–≥–¥–∞ –¥—Ä—É–≥ –ø–æ–∫—É–ø–∞–µ—Ç –ø–æ–¥–ø–∏—Å–∫—É, –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `processReferralBonus()`
6. –°—á–∏—Ç–∞–µ—Ç—Å—è –±–æ–Ω—É—Å:
   - **fixed** - —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—É–º–º–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 50 —Ä—É–±)
   - **percent** - –ø—Ä–æ—Ü–µ–Ω—Ç –æ—Ç —Å—É–º–º—ã –ø–æ–∫—É–ø–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 10%)
7. –ë–æ–Ω—É—Å –Ω–∞—á–∏—Å–ª—è–µ—Ç—Å—è –Ω–∞ –±–∞–ª–∞–Ω—Å —Ä–µ—Ñ–µ—Ä–µ—Ä–∞
8. –°–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ `referrals` —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `completed`

### 10.2 –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã

```json
{
  "key": "referral",
  "value": {
    "enabled": true,
    "bonus_type": "fixed",
    "bonus_amount": 50
  }
}
```

### 10.3 API –¥–ª—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

**GET /api/referrals/**

Response:
```json
{
  "referral_code": "ABC12345",
  "referral_link": "https://noryx.com/register?ref=ABC12345",
  "total_referrals": 12,
  "total_earnings": 600,
  "referrals": [
    {
      "referred_id": "uuid",
      "referred_email": "friend@example.com",
      "bonus_amount": 50,
      "status": "completed",
      "created_at": "2026-02-10T12:00:00Z"
    }
  ]
}
```

---

## 11. FRONTEND

### 11.1 –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü

```
web_extracted/web/
‚îú‚îÄ‚îÄ pages/
‚îÇ   ‚îú‚îÄ‚îÄ index.html          # –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
‚îÇ   ‚îú‚îÄ‚îÄ login.html          # –í—Ö–æ–¥
‚îÇ   ‚îú‚îÄ‚îÄ register.html       # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ cabinet.html        # –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç
‚îÇ   ‚îú‚îÄ‚îÄ tariffs.html        # –¢–∞—Ä–∏—Ñ—ã
‚îÇ   ‚îú‚îÄ‚îÄ servers.html        # –°–µ—Ä–≤–µ—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ apps.html           # –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ news.html           # –ù–æ–≤–æ—Å—Ç–∏
‚îÇ   ‚îú‚îÄ‚îÄ support.html        # –ü–æ–¥–¥–µ—Ä–∂–∫–∞
‚îÇ   ‚îî‚îÄ‚îÄ referral.html       # –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞
‚îú‚îÄ‚îÄ assets/
‚îÇ   ‚îú‚îÄ‚îÄ styles.css          # –û–±—â–∏–µ —Å—Ç–∏–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ app.js              # –û–±—â–∞—è JS –ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ photo_2026-02-06_13-27-18.jpg  # –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
‚îÇ   ‚îî‚îÄ‚îÄ {D15AB384-...}.png  # –õ–æ–≥–æ—Ç–∏–ø
‚îî‚îÄ‚îÄ public/                 # –ö–æ–ø–∏—è –¥–ª—è legacy
```

### 11.2 –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å (public/admin.html)

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:**
- Bootstrap 5.3
- jQuery
- Chart.js (–¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤)

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- Dashboard —Å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –ø–æ–¥–ø–∏—Å–∫–∏, –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è)
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∞–º–∏ (–ø—Ä–æ–¥–ª–µ–Ω–∏–µ, –æ—Ç–º–µ–Ω–∞, –≤—ã–¥–∞—á–∞ —Ç—Ä–∏–∞–ª–∞)
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∞–º–∏ (–≤–∫–ª—é—á–µ–Ω–∏–µ/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ)
- –õ–æ–≥–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
- –ì—Ä–∞—Ñ–∏–∫–∏ –ø–æ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞–º –∏ —Å—Ç—Ä–∞–Ω–∞–º

**–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:**
–ü—Ä–æ—Å—Ç–æ–π Bearer token –≤ localStorage:
```javascript
const adminPassword = localStorage.getItem('adminPassword') || prompt('Admin Password:');
localStorage.setItem('adminPassword', adminPassword);

fetch('/api/admin/stats', {
  headers: {
    'Authorization': `Bearer ${adminPassword}`
  }
});
```

### 11.3 –î–µ–º–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ VPN –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (public/index.html)

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –∫–ª–∏–µ–Ω—Ç–∞
- –í—ã–±–æ—Ä —Å—Ç—Ä–∞–Ω—ã –∏–∑ —Å–ø–∏—Å–∫–∞
- –ö–Ω–æ–ø–∫–∞ "Connect to VPN"
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:
  - iOS/Android: –∫–Ω–æ–ø–∫–∞ "Open in VPN App"
  - Desktop: –∫–Ω–æ–ø–∫–∞ "Download Config File"
  - Unknown: QR –∫–æ–¥

**–ö–æ–¥:**
```javascript
async function smartConnect() {
  const response = await fetch('/api/vpn/connect', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      userId: USER_ID, // Demo user
      countryCode: countrySelect.value
    })
  });

  const data = await response.json();

  if (data.deepLink) {
    // iOS/Android
    html += `<a href="${data.deepLink}">Open in VPN App</a>`;
  }

  if (data.downloadUrl) {
    // Desktop
    html += `<a href="${data.downloadUrl}" download>Download Config File</a>`;
  }

  if (data.qrCode) {
    // Unknown
    html += `<img src="${data.qrCode}" alt="QR Code">`;
  }
}
```

---

## 12. –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨

### 12.1 Middleware –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

#### Helmet.js
```javascript
app.use(helmet({
  contentSecurityPolicy: false, // –î–ª—è –∏–Ω–ª–∞–π–Ω —Å–∫—Ä–∏–ø—Ç–æ–≤ –≤ –¥–µ–º–æ
}));
```

#### CORS
```javascript
const allowedOrigins = process.env.ALLOWED_ORIGINS.split(',');
app.use(cors({
  origin: (origin, callback) => {
    if (!origin || allowedOrigins.includes(origin)) {
      callback(null, true);
    } else {
      callback(new Error('Not allowed by CORS'));
    }
  },
  credentials: true,
}));
```

#### Rate Limiting
```javascript
const limiter = rateLimit({
  windowMs: 15 * 60 * 1000, // 15 –º–∏–Ω—É—Ç
  max: 100,
  message: 'Too many requests from this IP, please try again later.',
});
app.use('/api/', limiter);
```

### 12.2 –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è (src/security.js)

```javascript
function validateEmail(email) {
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  return emailRegex.test(email);
}

function validateUsername(username) {
  const usernameRegex = /^[a-zA-Z0-9_-]{3,32}$/;
  return usernameRegex.test(username);
}

function sanitizeInput(input) {
  return input.trim().replace(/[<>]/g, '');
}
```

### 12.3 –ó–∞—â–∏—Ç–∞ –æ—Ç SQL Injection

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤:

```javascript
// ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ
pool.query('SELECT * FROM users WHERE email = $1', [email]);

// ‚ùå –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ
pool.query(`SELECT * FROM users WHERE email = '${email}'`);
```

### 12.4 –°–µ–∫—Ä–µ—Ç—ã –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–µ —Å–µ–∫—Ä–µ—Ç—ã:**
- `HMAC_SECRET` - –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ download —Ç–æ–∫–µ–Ω–æ–≤
- `JWT_SECRET` - –¥–ª—è JWT —Ç–æ–∫–µ–Ω–æ–≤
- `ADMIN_PASSWORD` - –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏
- `DB_PASSWORD` - –ø–∞—Ä–æ–ª—å –ë–î
- `REMNAWAVE_API_KEY` / `REMNAWAVE_API_SECRET` - RemnaWave API credentials
- `VITE_SUPABASE_ANON_KEY` - Supabase anon key

**–í—Å–µ —Å–µ–∫—Ä–µ—Ç—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ .env —Ñ–∞–π–ª–µ –∏ –ù–ò–ö–û–ì–î–ê –Ω–µ –∫–æ–º–º–∏—Ç—è—Ç—Å—è –≤ Git.**

### 12.5 Row Level Security (RLS) –≤ Supabase

–í—Å–µ —Ç–∞–±–ª–∏—Ü—ã –∑–∞—â–∏—â–µ–Ω—ã RLS –ø–æ–ª–∏—Ç–∏–∫–∞–º–∏:
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ
- –ê–¥–º–∏–Ω—ã –∏–º–µ—é—Ç –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ —Ñ—É–Ω–∫—Ü–∏—é `is_admin()`
- –ü—É–±–ª–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (tariffs, news) –¥–æ—Å—Ç—É–ø–Ω—ã –±–µ–∑ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

---

## 13. –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø

### 13.1 –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env)

```bash
# Server
PORT=3000
NODE_ENV=production

# Local PostgreSQL Database
DB_HOST=localhost
DB_PORT=5432
DB_NAME=noryx_vpn
DB_USER=postgres
DB_PASSWORD=your_password_here

# Supabase (Cloud Database + Auth)
VITE_SUPABASE_URL=https://xxxxxxxxxxxxx.supabase.co
VITE_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

# RemnaWave API (VPN Provider)
REMNA_BASE_URL=https://panel.example.com
REMNA_API_AUTH_MODE=basic
REMNA_ADMIN_LOGIN=admin
REMNA_ADMIN_PASSWORD=admin_password
REMNA_API_TOKEN=your_api_token_if_token_mode

# Security
HMAC_SECRET=your_random_secret_key_here_min_32_chars
TOKEN_EXPIRY_SECONDS=300
JWT_SECRET=your_jwt_secret_key_here_min_32_chars
ADMIN_PASSWORD=admin123

# CORS
ALLOWED_ORIGINS=http://localhost:3000,https://noryx.com
```

### 13.2 package.json scripts

```json
{
  "scripts": {
    "start": "node src/server.js",
    "dev": "nodemon src/server.js",
    "init-db": "node src/database/init.js",
    "seed-demo": "node scripts/seed-demo-data.js",
    "test-api": "./scripts/test-endpoints.sh"
  }
}
```

---

## 14. –ó–ê–ü–£–°–ö –ò –î–ï–ü–õ–û–ô

### 14.1 –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã

**–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- OS: Ubuntu 22.04 / Debian 11+
- CPU: 2 cores
- RAM: 2 GB
- Disk: 20 GB SSD
- Node.js: 18+
- PostgreSQL: 14+
- Docker + Docker Compose (–¥–ª—è RemnaWave)

### 14.2 –ü–æ—Ä—Ç—ã

| –°–µ—Ä–≤–∏—Å | –ü–æ—Ä—Ç | –ü—Ä–æ—Ç–æ–∫–æ–ª | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|--------|------|----------|------------|
| Noryx App | 3000 | HTTP/HTTPS | –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ |
| RemnaWave Panel | 3000 | HTTP/HTTPS | VPN –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è |
| RemnaWave Sub Page | 3010 | HTTP | –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–¥–ø–∏—Å–æ–∫ |
| PostgreSQL | 5432 | TCP | –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö |
| Caddy (Reverse Proxy) | 80, 443 | HTTP/HTTPS | –í–µ–±-—Å–µ—Ä–≤–µ—Ä |

### 14.3 –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

#### –≠—Ç–∞–ø 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
# Node.js
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs

# PostgreSQL
sudo apt install postgresql postgresql-contrib

# Docker
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh
```

#### –≠—Ç–∞–ø 2: RemnaWave Panel

```bash
# Download docker-compose
wget -O docker-compose.yml https://docs.rw/api/download/docker-compose-remnawave-panel.yml

# Generate secrets
NEW_SECRET=$(openssl rand -base64 32)
NEW_DB_PASSWORD=$(openssl rand -base64 16)

# Replace in docker-compose.yml
sed -i "s|SECRET_KEY_HERE|$NEW_SECRET|g" docker-compose.yml
sed -i "s|DB_PASSWORD_HERE|$NEW_DB_PASSWORD|g" docker-compose.yml

# Create .env
cat > .env <<EOF
SECRET_KEY=$NEW_SECRET
DATABASE_URL=postgresql://remnawave:$NEW_DB_PASSWORD@postgres:5432/remnawave
EOF

# Start
docker-compose up -d
```

#### –≠—Ç–∞–ø 3: RemnaWave Subscription Page

```bash
mkdir remnawave-sub && cd remnawave-sub

cat > docker-compose.yml <<EOF
services:
  remnawave-subscription-page:
    image: remnawave/subscription-page:latest
    container_name: remnawave-subscription-page
    hostname: remnawave-subscription-page
    restart: always
    env_file:
      - .env
    ports:
      - '127.0.0.1:3010:3010'
    networks:
      - remnawave-network

networks:
  remnawave-network:
    driver: bridge
    external: true
EOF

cat > .env <<EOF
REMNAWAVE_BACKEND_URL=http://remnawave-panel:3000
REMNAWAVE_API_TOKEN=your_api_token_from_panel
EOF

docker-compose up -d
```

#### –≠—Ç–∞–ø 4: Noryx App

```bash
git clone <repo> && cd noryx-vpn
npm install
cp .env.example .env
nano .env  # Configure all variables

# Initialize database
npm run init-db

# Start
npm start

# Or with PM2
npm install -g pm2
pm2 start src/server.js --name noryx-vpn
pm2 save
pm2 startup
```

#### –≠—Ç–∞–ø 5: Reverse Proxy (Caddy)

```bash
sudo apt install -y debian-keyring debian-archive-keyring apt-transport-https
curl -1sLf 'https://dl.cloudsmith.io/public/caddy/stable/gpg.key' | sudo gpg --dearmor -o /usr/share/keyrings/caddy-stable-archive-keyring.gpg
curl -1sLf 'https://dl.cloudsmith.io/public/caddy/stable/debian.deb.txt' | sudo tee /etc/apt/sources.list.d/caddy-stable.list
sudo apt update
sudo apt install caddy

# Caddyfile
sudo nano /etc/caddy/Caddyfile
```

```caddy
noryx.com {
    reverse_proxy localhost:3000
}

panel.noryx.com {
    reverse_proxy localhost:3000
}

sub.noryx.com {
    reverse_proxy localhost:3010
}
```

```bash
sudo systemctl restart caddy
```

---

## 15. –ú–û–ù–ò–¢–û–†–ò–ù–ì –ò –õ–û–ì–ò–†–û–í–ê–ù–ò–ï

### 15.1 Winston Logger (src/logger.js)

```javascript
import winston from 'winston';

export const logger = winston.createLogger({
  level: process.env.LOG_LEVEL || 'info',
  format: winston.format.combine(
    winston.format.timestamp(),
    winston.format.errors({ stack: true }),
    winston.format.json()
  ),
  transports: [
    new winston.transports.Console({
      format: winston.format.simple()
    }),
    new winston.transports.File({ filename: 'logs/error.log', level: 'error' }),
    new winston.transports.File({ filename: 'logs/combined.log' })
  ]
});
```

### 15.2 Health Check

**GET /health**

```json
{
  "status": "healthy",
  "timestamp": "2026-02-16T10:00:00Z",
  "uptime": 86400,
  "env": "production",
  "services": {
    "supabase": true,
    "remnawave": true
  }
}
```

---

## 16. –§–ê–ô–õ–û–í–ê–Ø –°–¢–†–£–ö–¢–£–†–ê –ü–†–û–ï–ö–¢–ê

```
noryx-premium-vpn/
‚îú‚îÄ‚îÄ .env                        # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–Ω–µ –≤ git)
‚îú‚îÄ‚îÄ .env.example                # –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ package.json                # NPM –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ package-lock.json
‚îú‚îÄ‚îÄ README.md                   # –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ (–¥–ª—è –Ω–æ–≤–∏—á–∫–æ–≤)
‚îú‚îÄ‚îÄ TECHNICAL_SPECIFICATION.md  # –≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç
‚îÇ
‚îú‚îÄ‚îÄ public/                     # –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã (legacy)
‚îÇ   ‚îú‚îÄ‚îÄ index.html              # –î–µ–º–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ Smart Connect
‚îÇ   ‚îî‚îÄ‚îÄ admin.html              # –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å (Bootstrap 5)
‚îÇ
‚îú‚îÄ‚îÄ admin-panel/                # –ö–æ–ø–∏—è –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ index.html
‚îÇ   ‚îî‚îÄ‚îÄ README.txt
‚îÇ
‚îú‚îÄ‚îÄ web_extracted/              # –ù–æ–≤—ã–µ –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü—ã
‚îÇ   ‚îî‚îÄ‚îÄ web/
‚îÇ       ‚îú‚îÄ‚îÄ pages/              # HTML —Å—Ç—Ä–∞–Ω–∏—Ü—ã (10 —à—Ç)
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ index.html
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ login.html
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ register.html
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ cabinet.html
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ tariffs.html
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ servers.html
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ apps.html
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ news.html
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ support.html
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ referral.html
‚îÇ       ‚îî‚îÄ‚îÄ assets/             # CSS, JS, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
‚îÇ           ‚îú‚îÄ‚îÄ styles.css
‚îÇ           ‚îú‚îÄ‚îÄ app.js
‚îÇ           ‚îî‚îÄ‚îÄ *.jpg, *.png
‚îÇ
‚îú‚îÄ‚îÄ src/                        # Backend –∫–æ–¥
‚îÇ   ‚îú‚îÄ‚îÄ server.js               # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îÇ   ‚îú‚îÄ‚îÄ config.js               # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ logger.js               # Winston logger
‚îÇ   ‚îú‚îÄ‚îÄ security.js             # –í–∞–ª–∏–¥–∞—Ü–∏—è, —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ scheduler.js            # Cron –∑–∞–¥–∞—á–∏ (—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, —Ä–∞—Å—Å—ã–ª–∫–∏)
‚îÇ   ‚îú‚îÄ‚îÄ supabase.js             # Supabase –∫–ª–∏–µ–Ω—Ç
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ db.js               # PostgreSQL pool
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ init.js             # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ schema.sql          # SQL —Å—Ö–µ–º–∞
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ middleware/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.js             # JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ adminAuth.js        # Admin Bearer token auth
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ vpn.js              # /api/vpn/* (connect, countries, download)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ admin.js            # /api/admin/* (users, subscriptions, stats)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.js             # /api/auth/* (register, login, profile)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ subscriptions.js    # /api/subscriptions/* (purchase, renew)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tariffs.js          # /api/tariffs/*
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ referrals.js        # /api/referrals/*
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ news.js             # /api/news/*
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ notifications.js    # /api/notifications/*
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ mailings.js         # /api/mailings/*
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ servers.js          # /api/servers/*
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ services/
‚îÇ       ‚îú‚îÄ‚îÄ remnawave.js        # RemnaWave API –∫–ª–∏–µ–Ω—Ç
‚îÇ       ‚îú‚îÄ‚îÄ platformDetector.js # Platform detection (iOS/Android/...)
‚îÇ       ‚îú‚îÄ‚îÄ tokenService.js     # HMAC token –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
‚îÇ       ‚îî‚îÄ‚îÄ qrService.js        # QR code –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
‚îÇ
‚îú‚îÄ‚îÄ src_extracted/              # –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è –≤–µ—Ä—Å–∏—è src (–±–æ–ª–µ–µ –Ω–æ–≤–∞—è)
‚îÇ   ‚îî‚îÄ‚îÄ src/
‚îÇ       ‚îú‚îÄ‚îÄ server.js           # Express app —Å scheduler
‚îÇ       ‚îú‚îÄ‚îÄ supabase.js         # Supabase + auth helpers
‚îÇ       ‚îú‚îÄ‚îÄ remnawave.js        # RemnaWave API —Å retry logic
‚îÇ       ‚îú‚îÄ‚îÄ scheduler.js        # Notifications + mailings scheduler
‚îÇ       ‚îú‚îÄ‚îÄ security.js         # Validation + sanitization
‚îÇ       ‚îú‚îÄ‚îÄ logger.js           # Winston
‚îÇ       ‚îú‚îÄ‚îÄ config.js           # Centralized config
‚îÇ       ‚îî‚îÄ‚îÄ routes/             # –í—Å–µ routes (auth, subscriptions, etc)
‚îÇ
‚îú‚îÄ‚îÄ lib_extracted/              # TypeScript –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
‚îÇ   ‚îî‚îÄ‚îÄ lib/
‚îÇ       ‚îú‚îÄ‚îÄ supabase-client.ts  # Supabase client
‚îÇ       ‚îú‚îÄ‚îÄ auth.ts             # Auth helpers
‚îÇ       ‚îî‚îÄ‚îÄ remnawave.ts        # RemnaWave API (TypeScript)
‚îÇ
‚îú‚îÄ‚îÄ supabase/                   # Supabase –º–∏–≥—Ä–∞—Ü–∏–∏
‚îÇ   ‚îî‚îÄ‚îÄ migrations/
‚îÇ       ‚îú‚îÄ‚îÄ 20260216140033_20260216_notifications_mailing_system.sql
‚îÇ       ‚îî‚îÄ‚îÄ 20260216140200_20260216_mailing_templates_content.sql
‚îÇ
‚îú‚îÄ‚îÄ supabase_extracted/         # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏
‚îÇ   ‚îî‚îÄ‚îÄ supabase/
‚îÇ       ‚îî‚îÄ‚îÄ migrations/
‚îÇ           ‚îú‚îÄ‚îÄ 20260215065332_add_missing_columns_for_vpn_platform.sql
‚îÇ           ‚îú‚îÄ‚îÄ 20260215134732_create_profile_trigger.sql
‚îÇ           ‚îî‚îÄ‚îÄ 20260216010123_20260216_fix_rls_performance_auth_functions.sql
‚îÇ
‚îú‚îÄ‚îÄ scripts/                    # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ seed-demo-data.js       # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–µ–º–æ-–¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ test-endpoints.sh       # –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API
‚îÇ   ‚îú‚îÄ‚îÄ check-ports.sh          # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ check-status.sh         # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Å–µ—Ä–≤–∏—Å–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ dev-start.sh            # –ó–∞–ø—É—Å–∫ dev –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ restart-all.sh          # –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ setup-existing-ssl.sh   # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSL
‚îÇ   ‚îî‚îÄ‚îÄ update-server.sh        # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞
‚îÇ
‚îú‚îÄ‚îÄ tests/                      # –¢–µ—Å—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ smoke.test.js           # Smoke tests
‚îÇ
‚îî‚îÄ‚îÄ logs/                       # –õ–æ–≥–∏ (—Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
    ‚îú‚îÄ‚îÄ error.log
    ‚îî‚îÄ‚îÄ combined.log
```

---

## 17. –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ü–†–û–ï–ö–¢–ê

### 17.1 –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤ | –°—Ç—Ä–æ–∫–∏ –∫–æ–¥–∞ (–ø—Ä–∏–º–µ—Ä–Ω–æ) |
|-----------|-------------------|------------------------|
| Backend (src/) | 20+ | ~3000 |
| Frontend (web/pages/) | 10 | ~2000 |
| Admin Panel (admin.html) | 1 | 640 |
| Migrations (supabase/) | 5 | ~800 |
| Scripts | 8 | ~500 |
| **–ò—Ç–æ–≥–æ** | **44+** | **~6940** |

### 17.2 Endpoints API

- **VPN**: 4 endpoints
- **Auth**: 4 endpoints
- **Subscriptions**: 3 endpoints
- **Admin**: 9 endpoints
- **Tariffs**: 1 endpoint
- **Referrals**: 1 endpoint
- **News**: 2 endpoints
- **Notifications**: 2 endpoints
- **Mailings**: 3 endpoints
- **Servers**: 1 endpoint
- **Settings**: 1 endpoint

**–ò—Ç–æ–≥–æ: 31 endpoint**

### 17.3 –¢–∞–±–ª–∏—Ü—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

**–õ–æ–∫–∞–ª—å–Ω–∞—è PostgreSQL:**
- users
- subscriptions
- vpn_configs
- connection_logs
- available_countries

**–°—É–º–º–∞—Ä–Ω–æ: 5 —Ç–∞–±–ª–∏—Ü**

**Supabase PostgreSQL:**
- profiles
- tariffs
- subscriptions
- referrals
- notifications
- notification_templates
- notification_history
- mailing_templates
- mailings
- mailing_history
- news
- payments
- app_settings

**–°—É–º–º–∞—Ä–Ω–æ: 13 —Ç–∞–±–ª–∏—Ü**

**–í—Å–µ–≥–æ —Ç–∞–±–ª–∏—Ü: 18**

---

## 18. –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –û–°–û–ë–ï–ù–ù–û–°–¢–ò –ò –ü–†–ï–ò–ú–£–©–ï–°–¢–í–ê

### 18.1 Smart Connect

–£–Ω–∏–∫–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –∏ –≤—ã–¥–∞—á–∏ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞ VPN-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:
- **iOS**: Deep-link –¥–ª—è Shadowrocket (–æ–¥–∏–Ω –∫–ª–∏–∫)
- **Android**: Deep-link –¥–ª—è V2RayNG (–æ–¥–∏–Ω –∫–ª–∏–∫)
- **Desktop**: –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ —Å HMAC —Ç–æ–∫–µ–Ω–æ–º (5 –º–∏–Ω)
- **Unknown**: QR –∫–æ–¥ –¥–ª—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

### 18.2 –î–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

- **–õ–æ–∫–∞–ª—å–Ω–∞—è PostgreSQL**: –±—ã—Å—Ç—Ä—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏, connection logs
- **Supabase PostgreSQL**: –æ–±–ª–∞—á–Ω–∞—è –ë–î —Å RLS, Auth, Storage

### 18.3 –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è

- **Cron –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∑–∞ 24h, 10h, 0h –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è
- **–°–µ–≥–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–∞—Å—Å—ã–ª–∫–∏**: –æ—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ —Å–µ–≥–º–µ–Ω—Ç–∞–º (—Ç—Ä–∏–∞–ª, –∞–∫—Ç–∏–≤–Ω—ã–µ, –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–µ)
- **Auto-provisioning**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ VPN-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —á–µ—Ä–µ–∑ RemnaWave API

### 18.4 –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞

–í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å –≥–∏–±–∫–∏–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –±–æ–Ω—É—Å –∏–ª–∏ –ø—Ä–æ—Ü–µ–Ω—Ç).

### 18.5 –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- HMAC —Ç–æ–∫–µ–Ω—ã –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥–æ–≤
- JWT –¥–ª—è API –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- Row Level Security –≤ Supabase
- Rate limiting (100 req/15min)
- CORS, Helmet, Input validation

---

## 19. –ò–ó–í–ï–°–¢–ù–´–ï –û–ì–†–ê–ù–ò–ß–ï–ù–ò–Ø

1. **Email/Telegram –æ—Ç–ø—Ä–∞–≤–∫–∞**: –í —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ä–∞—Å—Å—ã–ª–∫–∏ —Ç–æ–ª—å–∫–æ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è, —Ä–µ–∞–ª—å–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞
2. **–ü–ª–∞—Ç–µ–∂–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**: –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø–ª–∞—Ç–µ–∂–Ω—ã–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏ (Stripe, PayPal)
3. **–ú–Ω–æ–≥–æ—è–∑—ã—á–Ω–æ—Å—Ç—å**: –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ç–æ–ª—å–∫–æ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
4. **Mobile –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**: –ù–µ—Ç –Ω–∞—Ç–∏–≤–Ω—ã—Ö iOS/Android –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π, —Ç–æ–ª—å–∫–æ web
5. **WebSocket**: –ù–µ—Ç real-time —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π, —Ç–æ–ª—å–∫–æ polling

---

## 20. ROADMAP (–ë–£–î–£–©–ò–ï –£–õ–£–ß–®–ï–ù–ò–Ø)

1. **Stripe/PayPal –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –ø–ª–∞—Ç–µ–∂–µ–π
2. **Email –ø—Ä–æ–≤–∞–π–¥–µ—Ä** (SendGrid, Mailgun) –¥–ª—è —Ä–µ–∞–ª—å–Ω—ã—Ö —Ä–∞—Å—Å—ã–ª–æ–∫
3. **Telegram –±–æ—Ç** –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∞–º–∏
4. **WebSocket** –¥–ª—è real-time —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
5. **CDN** –¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤ (Cloudflare, AWS CloudFront)
6. **Grafana + Prometheus** –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
7. **CI/CD** (GitHub Actions) –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–µ–ø–ª–æ—è
8. **Docker Compose** –¥–ª—è –≤—Å–µ–≥–æ —Å—Ç–µ–∫–∞ (Noryx + RemnaWave + PostgreSQL)
9. **Multi-language** –ø–æ–¥–¥–µ—Ä–∂–∫–∞ (English, Spanish, Chinese)
10. **Mobile –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è** (React Native / Flutter)

---

## 21. –ö–û–ù–¢–ê–ö–¢–´ –ò –ü–û–î–î–ï–†–ñ–ö–ê

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- RemnaWave: https://docs.rw/
- Supabase: https://supabase.com/docs

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞:**
- Email: support@noryx.com
- Telegram: @noryx_support

---

**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:** 1.0
**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2026-02-16
**–ê–≤—Ç–æ—Ä:** Technical Team Noryx Premium VPN
