<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Site Builder</title>
</head>
<body style="font-family:Arial;max-width:960px;margin:30px auto;padding:0 12px">
  <h2>Конструктор сайта (Admin)</h2>
  <p>Сущности: <b>hero, features, pricing, faq, footer</b>. Есть draft/publish и rollback версии.</p>

  <div style="display:flex;gap:8px;flex-wrap:wrap">
    <select id="key" style="padding:8px">
      <option value="hero">hero</option>
      <option value="features">features</option>
      <option value="pricing">pricing</option>
      <option value="faq">faq</option>
      <option value="footer">footer</option>
    </select>
    <input id="title" placeholder="title" style="flex:1;min-width:240px;padding:8px">
  </div>

  <textarea id="body" placeholder="body" style="width:100%;height:100px;margin-top:8px"></textarea>
  <input id="imageUrl" placeholder="image url" style="width:100%;padding:8px;margin-top:8px">

  <div style="margin-top:8px;display:flex;gap:8px;flex-wrap:wrap">
    <button onclick="saveDraft()">Сохранить draft</button>
    <button onclick="publishSection()">Опубликовать</button>
    <input id="rollbackVersion" placeholder="версия для rollback" style="width:180px;padding:8px">
    <button onclick="rollbackSection()">Откатить версию</button>
    <button onclick="loadVersions()">Показать версии</button>
  </div>

  <hr>
  <input id="aiPrompt" placeholder="AI prompt" style="width:70%;padding:8px">
  <button onclick="genText()">AI текст (GigaChat)</button>

  <pre id="out" style="white-space:pre-wrap;background:#f5f5f5;padding:10px;border-radius:8px"></pre>

  <script>
  const s = JSON.parse(localStorage.getItem('vpn_session')||'null');
  if(!s?.token || s?.user?.role!=='admin') location.href='/login.html';
  const H = {'Content-Type':'application/json', Authorization:'Bearer '+s.token};

  async function api(path, options = {}) {
    const res = await fetch(path, { headers: H, ...options });
    const data = await res.json();
    out.textContent = JSON.stringify(data, null, 2);
    return data;
  }

  async function saveDraft(){
    await api('/api/admin/site-builder/content/'+encodeURIComponent(key.value), {
      method:'PUT',
      body: JSON.stringify({title:title.value, body:body.value, imageUrl:imageUrl.value}),
    });
  }

  async function publishSection(){
    await api('/api/admin/site-builder/content/'+encodeURIComponent(key.value)+'/publish', { method:'POST' });
  }

  async function rollbackSection(){
    await api('/api/admin/site-builder/content/'+encodeURIComponent(key.value)+'/rollback', {
      method:'POST',
      body: JSON.stringify({ version: Number(rollbackVersion.value) })
    });
  }

  async function loadVersions(){
    await api('/api/admin/site-builder/content/'+encodeURIComponent(key.value)+'/versions');
  }

  async function genText(){
    const data = await api('/api/admin/site-builder/ai/text', {
      method:'POST',
      body: JSON.stringify({prompt: aiPrompt.value, sectionKey: key.value})
    });
    if(data.text) body.value = data.text;
  }
  </script>
</body>
</html>
<!DOCTYPE html><html lang="ru"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Site Builder</title></head>
<body style="font-family:Arial;max-width:900px;margin:30px auto">
<h2>Конструктор сайта (Admin)</h2>
<p>Редактирование секций + AI генерация текста/изображений.</p>
<input id="key" placeholder="section key (hero)" style="width:260px;padding:8px">
<input id="title" placeholder="title" style="width:260px;padding:8px">
<textarea id="body" placeholder="body" style="width:100%;height:90px;margin-top:6px"></textarea>
<input id="imageUrl" placeholder="image url" style="width:100%;padding:8px;margin-top:6px">
<button onclick="save()">Сохранить секцию</button>
<hr>
<input id="aiPrompt" placeholder="AI prompt" style="width:70%;padding:8px">
<button onclick="genText()">AI текст</button>
<button onclick="genImage()">AI картинка</button>
<pre id="out"></pre>
<script>
const s = JSON.parse(localStorage.getItem('vpn_session')||'null');
if(!s?.token || s?.user?.role!=='admin') location.href='/login.html';
const H = {'Content-Type':'application/json', Authorization:'Bearer '+s.token};
async function save(){
  const res = await fetch('/api/admin/site-builder/content/'+encodeURIComponent(key.value), {method:'PUT', headers:H, body:JSON.stringify({title:title.value, body:body.value, imageUrl:imageUrl.value})});
  out.textContent = JSON.stringify(await res.json(), null, 2);
}
async function genText(){
  const res = await fetch('/api/admin/site-builder/ai/text', {method:'POST', headers:H, body:JSON.stringify({prompt:aiPrompt.value})});
  const data = await res.json(); out.textContent = JSON.stringify(data, null, 2); if(data.text) body.value=data.text;
}
async function genImage(){
  const res = await fetch('/api/admin/site-builder/ai/image', {method:'POST', headers:H, body:JSON.stringify({prompt:aiPrompt.value})});
  const data = await res.json(); out.textContent = JSON.stringify(data, null, 2); if(data.imageUrl) imageUrl.value=data.imageUrl;
}
</script></body></html>
